
define(function(require,exports,module){'use strict';var tools=require('modules/tools');exports.config={lang:{M01:'Saving your settings, please wait...'}};var cache={},config=exports.config;exports.init=function(args){tools.ready(function(){exports.submit_tip();exports.tab_bind();exports.select_text();})};exports.submit_tip=function(){I('backend-options-frm').addEventListener('submit',function(){tools.ajax_loading_tip('loading',config.lang.M01);return true;});}
exports.select_text=function(){var $inputs=document.querySelectorAll('.text-select');if(!$inputs[0])
return false;Array.prototype.forEach.call($inputs,function($input,i){$input.addEventListener('click',function(){this.select();});});};exports.tab_bind=function(){cache.$tab=I('backend-tab');if(!cache.$tab)
return false;cache.$tab_loading=document.querySelector('.backend-tab-loading');cache.$tab_header=cache.$tab.querySelector('.tab-header');cache.$tab_header_items=cache.$tab_header.querySelectorAll('.tab-item');cache.$tab_body=cache.$tab.querySelector('.tab-body');cache.$tab_body_items=cache.$tab_body.querySelectorAll('.tab-item');cache.len=cache.$tab_header_items.length;cache.last_active_i=0;cache.active_i=0;cache.actived=[];for(var i=0;i<cache.len;i++){cache.$tab_header_items[i].setAttribute('data-i',i);cache.$tab_header_items[i].addEventListener(('ontouchstart'in document.documentElement?'touchstart':'mouseover'),event_tab_header_hover);}
cache.$tab_loading.style.display='none';cache.$tab.style.display='block';last_tab_init();tab_nav_init();tab_nav_fixed_init();}
function event_tab_header_hover(e){e.preventDefault();e.stopPropagation();cache.active_i=this.getAttribute('data-i');if(cache.last_active_i==cache.active_i)
return false;action_tab_hide(cache.last_active_i);action_tab_show(cache.active_i);action_tab_nav_hide(cache.last_active_i);action_tab_nav_show(cache.active_i);tab_nav_scroll_init();cache.last_active_i=cache.active_i;localStorage.setItem('backend-tab-last-active',cache.active_i);}
function last_tab_init(){cache.last_active_i=parseInt(localStorage.getItem('backend-tab-last-active'));if(!cache.last_active_i)
cache.last_active_i=0;cache.active_i=cache.last_active_i;action_tab_show(cache.last_active_i);}
function action_tab_show(i){cache.$tab_header_items[i].classList.add('active');cache.$tab_body_items[i].classList.add('active');}
function action_tab_hide(i){cache.$tab_header_items[i].classList.remove('active');cache.$tab_body_items[i].classList.remove('active');}
function tab_nav_init(){cache.$nav_container=document.createElement('div');cache.$nav_container.className='tab-nav-container';cache.$tab_body.insertBefore(cache.$nav_container,cache.$tab_body.firstChild);cache.admin_bar_height=32;cache.legend_tops=[];cache.$tab_nav=[];cache.$nav_items=[];cache.$tab_legends=[];for(var i=0;i<cache.len;i++){nav_item_create(i);}
action_tab_nav_show(cache.last_active_i);}
function nav_item_create(i){cache.$tab_nav[i]=document.createElement('nav');cache.$tab_nav[i].className='tab-nav';cache.$nav_items[i]={};cache.$tab_legends[i]=cache.$tab_body_items[i].querySelectorAll('legend');cache.last_tab_nav_active_i=0;if(!cache.$tab_legends[i][0])
return false;for(var j=0,len=cache.$tab_legends[i].length;j<len;j++){var title=cache.$tab_legends[i][j].innerHTML,text=cache.$tab_legends[i][j].textContent;if(!cache.$nav_items[i])
cache.$nav_items[i]=[];cache.$nav_items[i][j]=document.createElement('span');cache.$tab_legends[i][j].addEventListener('click',function(){scrollTo(0,0);});cache.$tab_legends[i][j].id=encodeURI(text);cache.$nav_items[i][j].setAttribute('data-hash',encodeURI(text));cache.$nav_items[i][j].setAttribute('data-i',i);cache.$nav_items[i][j].setAttribute('data-j',j);cache.$nav_items[i][j].innerHTML=title;cache.$nav_items[i][j].addEventListener('click',event_nav_item_click);cache.$tab_nav[i].appendChild(cache.$nav_items[i][j]);}
cache.$nav_container.appendChild(cache.$tab_nav[i]);}
function event_nav_item_click(e){e.preventDefault();var $legend=cache.$tab_legends[this.getAttribute('data-i')][this.getAttribute('data-j')],$parent=$legend.parentNode;scrollTo(0,tools.getElementTop($legend)-cache.admin_bar_height);history.pushState(null,null,'#'+this.getAttribute('data-hash'));$parent.classList.add('active');setTimeout(function(){$parent.classList.remove('active');},2000);}
function action_tab_nav_show(i){cache.$tab_nav[i].classList.add('active');}
function action_tab_nav_hide(i){cache.$tab_nav[i].classList.remove('active');}
function tab_nav_fixed_init(){cache.nav_ori_top=tools.getElementTop(cache.$nav_container)-cache.admin_bar_height;cache.is_fixed=false;tab_nav_scroll_init();}
function tab_nav_scroll_init(){if(cache.actived.indexOf(cache.active_i)!==-1)
return;cache.$nav_items[cache.active_i][0].classList.add('active');for(var j=0,len=cache.$tab_legends[cache.active_i].length;j<len;j++){if(!cache.legend_tops[cache.active_i])
cache.legend_tops[cache.active_i]=[];cache.legend_tops[cache.active_i][j]=parseInt(tools.getElementTop(cache.$tab_legends[cache.active_i][j]));}
window.addEventListener('scroll',function(e){event_tab_nav_fixed();event_legends_scroll();});cache.actived.push(cache.active_i);}
function event_legends_scroll(){var wot=parseInt(window.pageYOffset);var len=cache.legend_tops[cache.active_i].length;for(var i=0;i<len;i++){if((wot>=cache.legend_tops[cache.active_i][i]-cache.admin_bar_height*2)&&(wot<cache.legend_tops[cache.active_i][i+1])){if(cache.tab_nav_last_active_i!==i){for(var j=0;j<len;j++){cache.$nav_items[cache.active_i][j].classList.remove('active');}
cache.$nav_items[cache.active_i][i].classList.add('active');cache.tab_nav_last_active_i=i;}}}}
function event_tab_nav_fixed(){if(window.pageYOffset>=cache.nav_ori_top){if(!cache.is_fixed){cache.$tab_nav[cache.active_i].style.top=cache.admin_bar_height+'px';cache.$tab_nav[cache.active_i].style.position='fixed';cache.is_fixed=true;}}else{if(cache.is_fixed){cache.$tab_nav[cache.active_i].style.top=0;cache.$tab_nav[cache.active_i].style.position='relative';cache.is_fixed=false;}}}
function I(e){return document.getElementById(e);}});